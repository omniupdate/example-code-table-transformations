!function(t,e){"use strict";function a(t){var e=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date(t),i=a.getHours()>=12?"PM":"AM",n=(a.getMinutes()<10?"0":"")+a.getMinutes(),s=a.getHours();s>12?s-=12:0===s&&(s=12);var o=" "+s+":"+n+" "+i;return e[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()+o}function i(t){for(var e in t)t[e]["#text"]&&(t[e]=t[e]["#text"]);return t}function n(t){var e={};if(3==t.nodeType&&(e=t.nodeValue),t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var i=t.childNodes.item(a),s=i.nodeName;if("undefined"==typeof e[s])e[s]=n(i);else{if("undefined"==typeof e[s].push){var o=e[s];e[s]=[],e[s].push(o)}e[s].push(n(i))}}return e}var s=function(e,a){this.el=t(e),this.$notification=null,this.$widget=null,this.orgPadding=null,this.severity=null,this.defaults={archivedPath:"/ou-alerts/archived-alerts.xml",activePath:"/ou-alerts/active-alerts.xml",icon:!1,title:!0,subtitle:!0,description:!0,link:!0,date:!0,dateFormat:"",delay:!1,closeOnClick:!1,popup:!0,showClass:"fadeInDown",hideClass:"zoomOut",animationType:"animated-fast",emergency:{class:"oualerts-notify-error",position:"modal",icon:"fa fa-exclamation-triangle",iconColor:"#F44336",fontColor:"",backgroundColor:"#FFC5C0",template:!1},warning:{class:"oualerts-notify-warning",position:"top",icon:"fa fa-exclamation-circle",iconColor:"#f08a24",fontColor:"",backgroundColor:"#FFE5C0",template:!1},announcement:{class:"oualerts-notify-info",position:"top",icon:"fa fa-bullhorn",iconColor:"#6091ba",fontColor:"",backgroundColor:"",template:!1},widgetTemplate:!1,archiveHeader:!0},t.extend(!0,this.defaults,a),this.init()};s.prototype.init=function(){var t=this;this.loading(),"active"===this.defaults.type?this.fetch("active").then(function(e){e&&(t.defaults.popup===!0?t.notify(e.alert,t.defaults):(t.loading(!0),t.widget(e,t.defaults)))}):this.fetch("archived").then(function(e){t.loading(!0),t.widget(e,t.defaults,!0)})},s.prototype.fetch=function(e){var a=this,i=t.Deferred(),s="active"===e?this.defaults.activePath:this.defaults.archivedPath;return t.ajax({type:"GET",url:s,dataType:"xml",success:function(t){"active"===e?i.resolve(a.prepareData(n(t))):i.resolve(a.prepareArchivedData(n(t)))},error:function(t){i.reject(t)}}),i},s.prototype.widget=function(t,e,a){"function"==typeof e.widgetTemplate?this.$widget=e.widgetTemplate(t,e):a?this.$widget=o(t,e):this.$widget=d(t,e),this.el.html(this.$widget)},s.prototype.notify=function(e,a){var i=this;this.severity=e["ou:severity"].toLowerCase(),"function"==typeof i.defaults[i.severity].template?this.$notification=i.defaults[i.severity].template(e,a):this.$notification=this.createNotificationTemplate(e,a),a.closeOnClick&&t("body").click(function(){i.remove()}),a.delay?setTimeout(function(){i.el.append(i.$notification),"top"===i.defaults[i.severity].position&&i.applyPadding()},a.delay):(this.el.append(this.$notification),"top"===i.defaults[i.severity].position&&i.applyPadding())},s.prototype.calcPadding=function(t){var e=this.$notification,a=t+e.height()+"px";this.el.css("padding-top",a)},s.prototype.applyPadding=function(){this.orgPadding=parseInt(this.el.css("padding-top")),this.calcPadding(this.orgPadding),t(e).resize(this.calcPadding(this.orgPadding))},s.prototype.remove=function(){var t=this;"top"===this.defaults[this.severity.toLowerCase()].position&&this.el.css("padding-top",this.orgPadding),this.$notification.removeClass(this.defaults.showClass).addClass(this.defaults.hideClass),e.AnimationEvent?this.$notification.on("oanimationend animationend webkitAnimationEnd",function(){t.$notification.remove()}):t.$notification.remove()},s.prototype.prepareArchivedData=function(e){var a=[];if(!e.rss.channel.item.length)return!1;t.each(e.rss.channel.item,function(n,s){"alert"===s["dc:type"]["#text"]&&(s.updates=[],t.each(e.rss.channel.item,function(t,e){"update"===e["dc:type"]["#text"]&&e["dc:identifier"]["#text"]===s["dc:identifier"]["#text"]&&s.updates.push(i(e))}),a.push(i(s)))});var n={archive:a,channel:{description:e.rss.channel.description["#text"],language:e.rss.channel.language["#text"],lastBuildDate:e.rss.channel.lastBuildDate["#text"],link:e.rss.channel.link["#text"],title:e.rss.channel.title["#text"]}};return n},s.prototype.prepareData=function(e){var a,n=[];if(!e.rss.channel.item.length)return!1;t.each(e.rss.channel.item,function(t,e){"alert"===e["dc:type"]["#text"]?a=i(e):"update"===e["dc:type"]["#text"]&&n.push(i(e))}),n.sort(function(t,e){return new Date(e.pubDate)-new Date(t.pubDate)});var s={alert:a,updates:n,channel:{description:e.rss.channel.description["#text"],language:e.rss.channel.language["#text"],lastBuildDate:e.rss.channel.lastBuildDate["#text"],link:e.rss.channel.link["#text"],title:e.rss.channel.title["#text"]}};return s},s.prototype.loading=function(t){this.defaults.popup||t?t&&(this.el.addClass("ready"),this.el.removeClass("loading")):this.el.addClass("loading")};var o=function(e,a){var i=t('<div class="oualerts-archive-wrapper"></div>'),n=t("<h2>Archived Alerts</h2>"),s=t('<ul class="oualerts-archive-list"></ul>');return t.each(e.archive,function(e,i){var n=l(i,a),o=t('<li class="oualerts-archive"></li>'),d=t('<ul class="oualerts-update-cont"/>');if(o.append(n),i.updates&&i.updates.length){var c=t('<h4 class="oualerts-archive-update-header">UPDATES</h4>');o.append(c),o.append("<hr/>"),o.append(d),t.each(i.updates,function(e,n){var s=r(n,a,!0),o=t('<li class="oualerts-archive-update"></li>');e===i.updates.length-1?o.append(s):o.append(s).append("<hr/>"),d.append(o)}),o.append(d)}s.append(o)}),a.archiveHeader&&i.append(n),i.append(s),i},l=function(e,i){var n=t("<article/>"),s=t('<div class="oualerts-date">'+a(e.pubDate)+"</div>"),o=t('<h2 class="oualerts-title">'+e.title+"</h2>"),l=t('<p class="oualerts-msg">'+e.description+"</p>");if(i.icon){var r,d=i[e["ou:severity"].toLowerCase()].icon;if(d.indexOf("/")>-1)r=t('<img class="oualerts-title-icon" src="'+d+'" alt="Alert Icon"/>');else{r=t('<i class="'+d+'"></i>');var c=i[e["ou:severity"].toLowerCase()].iconColor;c&&r.css({color:c})}o.prepend(r)}return n.append(s).append(o),e["ou:subtitle"]&&n.append('<h3 class="oualerts-subtitle">'+e["ou:subtitle"]+"</h3>"),n.append(l),n},r=function(t,e,i){var n='<article><div class="oualerts-date oualerts-active-update-date">'+a(t.pubDate)+'</div><h5 class="'+(i?"":"oualerts-active-update-title")+'">'+t.title+'</h5><p class="oualerts-active-update-msg">'+t.description+"</p></article>";return n},d=function(e,a){var i=l(e.alert,a),n=t('<h4 class="oualerts-active-update-title">UPDATES</h4>'),s=t('<ul class="oualerts-active-update-list"/>');return t.each(e.updates,function(i,n){var o=t('<li class="oualerts-active-update"></li>');o.append(r(n,a)),i===e.updates.length-1?s.append(o):s.append(o).append("<hr/>")}),i.append(n).append("<hr/>").append(s),i};s.prototype.createNotificationTemplate=function(e,i){var n,s=this,o=i[e["ou:severity"].toLowerCase()],l=o.position,r=t("<div></div>",{class:"oualerts-notify "+o.class+" "+i.animationType+" "+i.showClass});if(n=t('<div class="oualerts-notify-body"/>'),i.date){var d=a(e.pubDate),c=t('<div class="oualerts-notify-date">'+d+"</div>");n.append(c)}if(i.title){var p=t('<h3 class="oualerts-notify-title">'+e.title+"</h3>");if(i.icon){var u=t('<i class="'+o.icon+'"></i>'),h=o.iconColor;h&&u.css({color:h}),p.prepend(u)}n.append(p)}if(i.subtitle&&e["ou:subtitle"]){var f=t('<h4 class="oualerts-notify-subtitle">'+e["ou:subtitle"]+"</h4>");n.append(f)}if(i.description){var v=t('<p class="oualerts-notify-msg">'+e.description+" </p>");if(i.link&&e.guid&&e.guid.indexOf(".xml")<0){var g=t('<a href="'+e.guid+'" target="_blank" class="oualerts-notify-link">Read More...</a>');v.append(g)}n.append(v)}r.append(n),t('<span class="oualerts-close">&times;</span>').on("click",function(){s.remove()}).appendTo(r);var y=o.backgroundColor;y&&r.css({backgroundColor:y});var m=o.fontColor;return m&&r.css({color:m}),"bottom"===l?r.addClass("oualerts-bottom"):"top"===l?r.addClass("oualerts-top"):"modal"===l&&(r.addClass("oualerts-modal"),o.modalSize?r.addClass(o.modalSize):r.addClass("large"),r=t('<div class="oualerts-notify-modal-overlay"/>').append(r)),r},t.fn.OUAlert=function(){var t=this,e=arguments[0],a=t.length,i=0;for(i;i<a;i++)t[i].OUAlert=new s(t[i],e);return t},e.OUAlerts=s}(jQuery,window);